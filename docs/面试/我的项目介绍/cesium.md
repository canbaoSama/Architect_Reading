## cesium 基础
八卦图坐标：lon: 114.575824, lat: 41.660928

cesium 最重要的就是自定义材料、自定义特殊图形、渲染帧率与浏览器帧率相同；


## 地形、瓦片图、路网等
1. 瓦片图和地形的加载可以使用默认的，如果要使用本地的就得自己下载完整的数据；
2. 如果自己爬虫下载官网的地形图，会发现用不了，打断点会发现那些地形文件是压缩的，需要解压缩；
3. 路网数据就自己找了，一般都会有的；
4. 全国到区的地理信息图，需要自己找，我是github上找到的，找了很久，然后需要经过自己处理一下；

## 标绘
1. cesium-draw-ts 插件；
2. 标绘主要绘制了点、线、面、长方形、多边形、圆、直线箭头、攻击箭头、钳击箭头等；每个绘制图形最重要的就是锚点位置的计算，如圆的化需要引入cesium自带的计算方法，新版本已经删除了，而箭头等需要引入turf；
3. 自定义材质,自定义颜色转换；

## 特殊模型
1. 特殊材质：类似于水波纹这样的特殊材质，带有动画效果，需要利用cesium的自定义材质功能实现；这玩意有一个模板，可以按照模板开发，自己确定好速度，动画时间等等效果；其实最为重要的就是里面的source参数怎么写，需要使用webgl的知识，像我一般都是用chatgpt4帮我写一下，或者自己查找资料；
2. 楔子锥面，无人车的侦察锥面；创建水波纹和box组合成的目标；抛物线；无人机向下侦察圆锥等；缓冲区侦察区域；流动线条；扫描雷达等

## 模型渲染
1. 加载上百数量的模型，模型需要自己调整并更新，可以在sketchfab上下载或者购买，压缩后通过Blender软件更改；
2. 不断地渲染时，如果根据浏览器刷新频率来更新坐标位置，由于性能问题，没有办法做到每一次的位置更新都能跟随时间实现渲染成功，会导致每一秒前面运行顺滑，后面直接跳位置，
这个时候主动降低每秒渲染次数，我I7一般支持5次；
3. 渲染数量过大时，需要降低模型的大小，尽量采用非动态模型；

## 特效
1. 雪花、雨水、大雾、强光等特效，viewer.scene.postProcessStages.add实现添加source代码
2. 流动水面做了两种效果；一种是仿真实效果，一种是颜色柱体；真实效果可以用new Material直接实现，用官网提供的水面波纹图就可以了；

## 任务播放器
1. 不断地播放一个模型的行驶轨迹，支持倍速、回看、暂停、跳转播放；
2. 主要就是弄一个缓存数据，实时存储并跟新一段时间内的模型的行驶路径；渲染使用的是CzmlDataSource创建的；
3. 当时遇到的主要问题就是数据的存储，先是尝试直接完整数据，但是数量量太大顶不住的；后面尝试websocket不断获取数据，然后存储再indexDB上，但是发现存储和拿取这些数据花的时间和性能非常大，不现实，后面只能选择存储在内存当中；
4. 我们的倍数有0.1到100，默认10倍数，所以需要预先拿到20秒的数据，防止初始播放的时候直接渲染误差导致播放到最后下一条数据还没到，从而停止了整个任务播放；
5. 仿制bilibili播放器设置，前后都有数据缓存，方便跳转播放的时候直接拿数据，主要是根据内部一个拿取参数判断的，这个拿取参数根据任务时长能得到最大值，每次拿一次数据就自增，等他超过最大值时就停止websocket的获取；
6. 因为要设置攀爬地形，所以给出的位置信息要包括方向、高度等；

## 注意事项
1. 位置的更新不能直接设置position,要通过CallbackProperty实现
2. 通过sampleTerrainMostDetailed去计算当前位置的海拔高度；
3. heightReference: HeightReference.CLAMP_TO_GROUND, 攀爬地形
   disableDepthTestDistance 和 distanceDisplayCondition 设置同一个点不同观察距离的显隐